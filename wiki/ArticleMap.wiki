#summary Mapping with MapWinGis in Tagbase

<wiki:toc max_depth="2" />

= Introduction =

This is one of the most exciting integration in Tagbase, with diverse functionalities from shapefile generation, oceanographic data download to interactive data lookup. We are actively gathering comments on what other capabilities we should add or expand.

= Requirements =

 * Make sure you have installed all the necessary plugins. See   *[HowToInstallPlugins Plugins Installation]* for details.

 * We only support [http://mapwingis.codeplex.com/releases/view/70023 MapWinGis 4.7] right now. More recent versions involve frequent updates to their basic functions, so we are sticking to an older, stable version for now.

= Limitations = 

 * Tagbase implements an ActiveX control of !MapWinGis and only intends to offer some basic GIS visualization. We can't create publication-quality maps, although we have plans to integrate Tagbase and GMT plotting routine in the future for static map production.

 * If you plan to conduct more sophisticated GIS operations, we recommend using Tagbase to help you generate the shapefiles you need. You can build a shapefile from tracks or any queries with two required fields, *`longitude`* and *`latitude`*.

= Starting Map Window =

 * From *Forms*, double-click to open the form, `MapWindow`

 * You also need to have tracking data imported in Tagbase. They can be raw geolocation positions, Argos/GPS positions or analysed tracks.

= Major functionalities =

http://tagbase.googlecode.com/svn/trunk/images/mapwindow.jpg

=== [ArticleMap#1._Shapefile_generation 1. Shapefile generation] ===
=== [ArticleMap#2._Basic_zooming,_browsing_and_layering 2. Basic zooming, browsing and layering]===
=== [ArticleMap#3._Labeling_or_coloring_shapefile_shapes_by_their_attributes 3. Labeling or coloring shapefile shapes by their attributes]===
=== [ArticleMap#4._Highlighting_shapefile_shapes_with_filters 4. Highlighting shapefile shapes with filters]===
=== [ArticleMap#5._Using_track_positions_to_query_tag_data 5. Using track positions to query tag data (the Identify Feature button)]===
=== [ArticleMap#6._Obtaining_satellite_imagery_across_the_Internet 6. Obtaining satellite imagery across the Internet]===
=== [ArticleMap#7._Showing_data_within_a_temporal_window_of_a_satellite_image 7. Showing data within a temporal window of a satellite image]===

  {{{
Hint - The MapWindow form has tool tips and status bar messages. 
       Hover your mouse over a button and hold for a second to show the tip.
       It will tell you what that button does
  }}}

== 1. Shapefile generation ==
_You make the necessary selections from left to right:_
 * *Create shapefile in folder* - type out the directory where you want to save the generated shapefile. You can also double-click to start the Browse-To dialog. Make sure this directory path is not empty, and that the directory exists in your computer.
 * *Analysed positions* - track data are obtained from `Analysis_Outputs` table. You need to have imported track data through procedures described in [ArticleGeolocate Running and importing a geolocation analysis]; or when you import a `LightLoc.csv` with saved results from the [ArticleWcDap#Utilizing_Kalman_filter/_Trackit_interfaces_in_GPE Kalman filter interface] of Wildlife Computers GPE software
 * *Raw positions* - track data from standard manufacturer processing in the following tables: `Proc_WC_Locations`, `Proc_SPOT_Locations`, `Proc_LTD_DayLog`, `Proc_Archival_Location`, `Proc_MT_Location`.
 * *User-defined query* - you can make a shapefile from a query or table, as long as you have 2 required fields: `longitude` and `latitude`. Other fields in your query/table will be saved to the shapefile as attributes. Note however, there is a 10-character limit to the names of attributes (`MapWinGis` limitation). Try use the [ArticleQuery#Query_1_-_Extract_time_series_data_during_a_specific_month alias technique] of a query to get around this problem.
 * *Start/end points* - you can make a point shapefile using deploy-popoff (or recovery) points info. the table `TagInfo`.
 * *Start/end lines* - you can make a polyline shapefile using deploy-popoff (or recovery) info. stored the table `TagInfo`.
 * *Start/end polygons* - you can make a polygon shapefile using deploy-popoff (or recovery) info. stored the table `TagInfo`, and raw geolocations stored in the manufacturer-specific location data tables (e.g. `Proc_WC_Locations`). Each polygon is for a single tag, which consists of 4 vertices - start & end points, and two vertices representing the average of all available geolocations in the entire tagging period + and - 1 standard deviation (i.e. avg. position +/- 1 sd). The goal here is to provide a very rough idea of the range of movement within the tagging period for a tag. This shapefile will also allow you use the [ArticleMap#5._Using_track_positions_to_query_tag_data Identify button] to call up the corresponding tag data. 
 * *Any* or other names of geolocation methods (e.g. trackit)- this is only applicable to `Analysed positions`. This control is populated with the records of the `AnalysisMethod` field in the `AnalysisInfo` table, where the `AnalysisType` field is `geolocation`.
 * *Add* - click this button to generate your shapefile. You will be prompted to enter a filename, click OK when you have done so. 
 * *Interpolate missing days* - checking this box will interpolate positions for timestamps in your tag data that have no associated latitude & longitude information. An attribute field `FlagGap` will be added to the shapefile, where original track positions are assigned a value of 0 and interpolated positions are assigned a value greater than 0. 
 * *Estimate sunrise/ sunset* - checking this box will approximate sunrise/sunset times based on date, latitude & longitude information and [http://www.srrb.noaa.gov/highlights/sunrise/sunrise.html NOAA computational routines]. This option is only available when `Interpolate missing days` is turned on.

== 2. Basic zooming, browsing and layering ==

 * Make sure you click on the name of a shapefile to highlight a layer before you perform an operation on the layer

 * The order in which the shapefiles appear will remain in the order you have added them i.e. a persistent ordering. This constraint is present due to the need to ensure compatibility with older MS Access versions.

 _Zooming and browsing operations can be carried out via the vertical button bar on the right_

 The zooming buttons from top to bottom are:
 * Zoom In
 * Zoom Out
 * Pan
 * Zoom to Full Extent
 * Previous Zoom
 * Zoom to Layer Extent

 _Layering can be done using the *Layers* panel on the left-handed side of the form _ 

 The layering buttons from left to right, then top to bottom are:
 * Pin to Top 

 * Add Shapefile
 * Add Image (previously downloaded images)
 * Remove All Layers
 * Remove Selected Layer

 * Turn Visible/ Invisible
 * Move to Top
 * Move Up
 * Move Down
 * Move to Bottom

== 3. Labeling or coloring shapefile shapes by their attributes ==

 * Make sure you have selected a shapefile and an attribute from the listboxes in order to perform any labeling or coloring
 * Coloring by attribute only works for a numerical attribute field (i.e. you can't color by a string/ text attribute field). Use the next topic to achieve [ArticleMap#4._Highlighting_shapefile_shapes_with_filters coloring by a string attribute field] instead

 The labeling/coloring buttons from left to right, then top to bottom are:
 * Show All Shapes (the _Spectacles_ icon)

 * Add Labels
 * Remove Labels
 * Remove All Screen Labels
 * Color Shapes by Attribute

 * When you click on the *Color Shapes by Attribute* button, shapes (track positions) will be automatically colored using the palette right beneath the _*Fields*_ listbox, using the minimum and maximum values of your selected field. 
 * *Auto* or *User* - You can specify the range of colored values by switching from *Auto* to *User* from the adjacent pull-down menu, then enter the values for `min` and `max` on both sides of the palette bar.
 * *Clear colors* - click on it to revert to the default color for all shapes, which is the *Color Square* to the left. Double-click on the *Color Square* to change and pick your own default color.

== 4. Highlighting shapefile shapes with filters ==
_You make the necessary selections from left to right:_
 * Make sure you have selected a shapefile and an attribute from the listboxes
 * *Parameter* - shows the field you have selected from the *Fields* list. This box will be activated once you finish making all the selections and having clicked *Apply*.
 * *Color* - select one of the colors from the list, or choose your own by selecting the `Custom` option from the pull-down list.
 * *Keep existing colors* - your previously highlighted shapes will retain their coloring. New colors will be updated for the shapes that meet your current criteria
 * *>=* or *<=* used for defining criteria for a numerical attribute in *Fields*
 * *=* used for defining criteria for a string attribute in *Fields*
 * *Filter by value* - enter a number as the filtering (i.e. highlighting) criteria
 * *or string* - enter a string here as the filtering (i.e. highlighting) criteria
 * *Display all points* - retain all shapes while coloring those that match your criteria
 * *Hide < or > limit* - show only shapes that meet your criteria
 * *Hide = zero* - hide shapes with a zero value (only for numerical attributes)
 * *Apply* - click to apply your highlighting selections

== 5. Using track positions to query tag data ==
 _When you display a track as a shapefile with the following fields/ attributes (`TagID`, `DateTime`), Tagbase is able to look up the tag data that accompanies the waypoint of a track. To do so, _
 * Click on the *Identify Feature* button 
 * Click on a point or do a click-and-drag to window a selection of points
 * A plot form will appear according to your selection of a point/ points
 * If you want to expand your selection by specifying how many days before and after the datetime stamp(s) of point(s), enter the number of days in *Show more (days)* before you make your selection.
 * We only support certain plot forms (*Pre-set defaults*) according to the tag type of your selection. Other plot forms will be supported in the near future via the pull-down menu *Plotting form*. Feel free to make a request using the wiki commenting.
 * The `Identify Feature` button will also function when you select a image on the `Layers` list. You can click on any pixel of an image to get the physical value displayed on the image as a label. The latitude-longitude-physical value will also be displayed on the *Info bar*.

== 6. Obtaining satellite imagery across the Internet ==
_You make the necessary selections from left to right:_
 * *Pick a Data Product* - from the pull-down menu, choose one of the default products or use `Choose your own` or `Last One used`. When you `Choose your own`, a new form will appear that takes you to a [http://coastwatch.pfeg.noaa.gov/erddap/index.html NOAA ERDDAP] catalog. Click on any link of a data product (*data*, *graph* or *M*) to make a selection. When the page is loaded completely, click on *Use this* and *Confirm & Close* to inform Tagbase of your satellite product of choice. 

http://tagbase.googlecode.com/svn/trunk/images/Erddap.jpg

  {{{
Note - Not all products on the NOAA ERDDAP catalog are supported. 
       Only the "griddap" products will display properly in the MapWindow form. 
       This is because only "griddap" products are formatted correctly as a 
       raster X-Y 2-dimensional image.
  }}}

 * *Variable* - once you have selected a data product, the available variable(s) for plotting will be updated. Pick from the list one of the variables when more than one variables are available.
 * *Extents* - choose `User` when you want to specific the lat-lon box for which data will be obtained. Select `Map` when you want Tagbase to approximate the correct lat-lon box using your current zoom-level on the displayed map.
 * *Lon Min*, *Lat Min*, *Lon Max*, *Lat Max* - allow you to define the boundaries of the lat-lon box where data are downloaded. Notice that when you have first selected the product, these boxes are updated with the extents of the data product. For example, if you have chosen a regional product, you will not be able to request data outside the boundaries as specified by the filled-in values here. Also, data products may use different longitude conventions, i.e from 0-360 or -180 to 180 degrees. Our filled-in values will likely to tell you which longitude convention is used by that particular data product.
 * *Start Date* - the earliest available date for the data product of your choice will be displayed here. Enter a different (later) start date in the form of year/month/day when appropriate.
 * *Download 1 only*- check on by default, which means only 1 image is downloaded. Uncheck to download more than one image, where you will see the *End Date* being activated.
 * *End Date* - the last available date for the data product of your choice will be displayed here. Enter a different (earlier) end date in the form of year/month/day when appropriate. This option will only be available when *Download 1 only* is unchecked
 * *Resolution* - choose the resolution of the downloaded image. So data product offers very high-resolution images and will take a long time to download. Choose a low-resolution to speed up the transfer. 

  {{{
Note - Tagbase overlays a downloaded image as a static .PNG file 
       onto the MapWindow. Alignment can be off slightly as a function of 
       the resolution, i.e. an image may not align completely with the world 
       map shapefile (continent.shp) when the resolution of the image is
       coarse. Please excuse us for this approximation, as we are not trying 
       to become a full-blown GIS system. 
  }}}

 * *For every 1 timestep* - your selected data product might be offered on a very frequent (daily) basis. If you prefer to shorten the download and obtain images every other day or every 5 days, enter the number of (every ?) timesteps you want to download.
 * *Image folder* - type out the directory where you want to save the downloaded images. You can also double-click to start the Browse-To dialog. Make sure this directory path is not empty, and that the directory exists in your computer.
 * *Download* - click the *Download* to initiate download. A window will pop-up in the background to show the progress of every downloading image. 
 * *Color bar* and *min*/*max* specification - an image is downloaded with the default *min*/*max* specification of your selected data product. You can change this range by switching from *Auto* to *User* here, and then enter the values in the boxes on the both sides of the color bar. A different palette (default is *Rainbow*) can also be selected through the pull-down menu. When you change the range or palette, you will need to re-download the image by clicking the *Reload* button.
 * *Reload* - click on this button to re-download an image when you have changed the range or palette.

== 7. Showing data within a temporal window of a satellite image ==
_When you are displaying a satellite image with a datestamp, you can use that as a constraint to display only track positions for that datestamp, or within a window of that datestamp_
 * Make sure you have selected and highlight an image in the *Layers* listbox. [ArticleMap#6._Obtaining_satellite_imagery_across_the_Internet Download new images] if you haven't done so. Or [ArticleMap#2._Basic_zooming,_browsing_and_layering load up an image] using the *Add Image* button. 
 * *Current Date* - the datestamp of your selected image will be displayed here when you have selected an image in the *Layers* listbox.
 * *First Record*, *Previous Record*, *Next Record*, *Last Record* buttons - you can jump to the first/previous/next/last available image of a set of images that you have downloaded in a single request. The new image will be displayed and loaded to your *Layers* list automatically. Of course, if you have only checked on *[ArticleMap#6._Obtaining_satellite_imagery_across_the_Internet Download 1 only]* during your download, this option will not be operational.
 * *Show Data within +/- windows (days)* - you can specific how many days before and after your image date that track positions are displayed. Enter 0 if you want to match the two up exactly. However, we recommend giving a larger window (> 1 day) to ensure at least some track positions are shown. You won't see any points if you have assigned too short a temporal window. When that happens, you may need to click on the *Show All Shapes (the _Spectacles_ icon)* to [ArticleMap#3._Labeling_or_coloring_shapefile_shapes_by_their_attributes restore the display] of all your track positions.
