#summary How to construct your query

<wiki:toc max_depth="2" />

= Introduction =

Query is a powerful way to interact with your data in any databases. Query utilizes a standard coding language known as structured query language (*[http://www.w3schools.com/sql/default.asp SQL]*) that are universal across platforms. The beauty about query is that you don't have to know any SQL syntax at all to construct your own query. Many software, like MS Access which Tagbase uses, provide a graphical interface (e.g. [http://www.eraserve.com/tutorials/MSACCESS_Queries.asp Query Builder]) for you to create query without typing a single line of code. What's more is that in Tagbase, you can do formulae or use functions just like you do in MS Excel. You can even do an Excel-style [http://www.databasedev.co.uk/crosstab_queries.html pivot table query] in Access.

We will run through a set of queries to illustrate how you can interrogate your data

= Accessing the Query Builder/ Query Designer = 
 
  * For Access 2003 and below, go to *Queries* under *Objects*. Click on the *Design* button.

http://tagbase.googlecode.com/svn/trunk/images/Query2000a.jpg  
  
  * For Access 2007 or above, go to the *Create* tab. Click *Query Design* to start the builder.
  
http://tagbase.googlecode.com/svn/trunk/images/Query2007a.jpg

= To follow along... =

  * Make sure you have imported the sample dataset. Refer to the *StarterKit* to help you achieve that.

  * To keep it simple, our example only has 1 fish with time series data in the database. 
  
  * You may also want to revisit the data model in Tagbase to facilitate you locating all the information you need. See *[ArticleTables Data tables and Relationships]* for details.

= Examples = 

== Query 1 - Extract time series data during a specific month  ==

 {{{
This example demonstrates how to you can filter your data.
 }}}

 * Create a new query by clicking the *Design* button (or *New* > *Design View* > *Ok* in older versions)

 * A *Show Table* dialog appears, stay in the default *Tables* tab

http://tagbase.googlecode.com/svn/trunk/images/Query2000b1.jpg 
 
 * Scroll down the list to click and highlight the table, `Proc_Archival_TempLight`. Click *Add*

 * The fields of the `Proc_Archival_TempLight` table are exposed in the Query Designer, scroll or resize the mini-window to see them 

 * Click/ double-click on the asterick `*` at the top to add all fields to your query. The asterick is a wildcard operator that means "Select All"

 * Next, click/ double-click on the `DateTime` field to add it to the query. We will use this as our filter

 * Apply a function, `Month` such that we only extract the month part of `DateTime`. To apply this function, type in *Field* the following:
 `Month([DateTime])`
 
  {{{ 
Tips -
Use a set of square brackets [ ] to denote a field name in functions or queries. 
This is particularly useful when a field name has spaces or special characters,
even though such naming convention is not recommended.
 }}}
 
 * You can nickname (use an alias) your field, for example, since we will filter data out for the month of July, we type out our function in *Field* as follows:
 `July: Month([DateTime])`
 
 * Type in the *Criteria*, 7, as our filter to get data from July
 
 * Let's practice the use of another function, `DateValue`. This function is useful in returning only the date part of a date time stamp. Type 
 `Daily: DateValue([DateTime])`
 
http://tagbase.googlecode.com/svn/trunk/images/Query2000b2.jpg 
 
 * Hit the exclamation mark *!* button (*Run*) to see the results

 * Close the query, and answer "Yes" when prompted to save the query.
 
http://tagbase.googlecode.com/svn/trunk/images/Query2000b3.jpg
 
 * Accept the default query name, "Query1" and click *Ok* 
 
http://tagbase.googlecode.com/svn/trunk/images/Query2000b4.jpg
 
 * Useful Note 1 - use *[http://office.microsoft.com/en-us/access-help/examples-of-query-criteria-HA010066611.aspx these examples of query criteria]* provided by Microsoft to help you master filtering by criteria. For example, filtering by dates will need to bound a date with hash signs #, and take the form of  `Between #12/1/2007# And #12/31/2007#`.
 
 * Useful Note 2 - unsure about what functions are available? Try the Expression Builder. Right-click on any *Field*, click on *Build*. Expand the *Functions* folder, and go to *Built-In Functions*. A list of the function categories and specific functions will then be listed in the other two boxes.
 
http://tagbase.googlecode.com/svn/trunk/images/QueryEx1.jpg 
http://tagbase.googlecode.com/svn/trunk/images/QueryEx2.jpg
 
== Query 2 - Summarize the daily maximum depth of a fish  ==

 {{{
We build upon the previous example and summarize your data as aggregated values (average, min or max).
 }}}
 
 * Start a new query, go to the tab, *Queries* when the *Show Table* dialog appears
 
http://tagbase.googlecode.com/svn/trunk/images/Query2000c1.jpg
 
 * Since we have only constructed one query, click/ double-click to add `Query1`

 * From the toolbar/ ribbon, click on the summation sign, which is labeled *Totals*
 
http://tagbase.googlecode.com/svn/trunk/images/Query2000c2.jpg

 * Add `TagID`, `Daily` and `Depth` from the field list of `Query1`

 * In the `Depth` field, click on the right-hand side downward arrow button to expand the options. Pick *Max* as the aggregating function.

http://tagbase.googlecode.com/svn/trunk/images/Query2000c3.jpg
 
 * Hit the exclamation mark *!* button (*Run*) to see the results
 
http://tagbase.googlecode.com/svn/trunk/images/Query2000c4.jpg 

 * Save query as `Query2`

== Query 3 - Extract the temperature experienced when a fish reached its daily maximum depth ==

 {{{
We again use the previous example and apply the query as a constraint to extract data
 }}}

 * Start a new query, from *Queries* tab of *Show Table* dialog, double-click/ click to add `Query1` and `Query2`
 
 * We will use a powerful feature of databases called *[http://support.microsoft.com/kb/136699 "Join"]*. 
 
 * Our joining fields are straightforward here. Between `Query1` and `Query2`, we will join up the following common fields:
 
 `TagID` <-> `TagID`
 
 `Daily` <-> `Daily`
 
 and constraint `Depth` by `MaxOfDepth`
 
 `Depth` <-> `MaxOfDepth`
 
 * To establish a join, click-and-drag on a field and release your click at the other end, at the field you wish to join. A line will connect the joined fields
 
http://tagbase.googlecode.com/svn/trunk/images/Query2000d1.jpg 

 * From `Query1`, select the fields, `TagID`, `DateTime`, `Depth` and `Temperature`
 
 * Add to *Criteria* >=100 for `Depth` to show only results deeper than or equal to 100 m
 
 * Hit the exclamation mark *!* button (*Run*) to see the results
 
http://tagbase.googlecode.com/svn/trunk/images/Query2000d2.jpg 

 * Save query as `Query3`

== Query 4 - Associated our extract fish data with metadata ==

 {{{
Our final example shows how you can add metadata to your extract data for an informative presentation
 }}}
 
  * Start a new query, from the *Show Table* dialog, double-click/ click to add query `Query3`, and tables `TagInfo`, `FishInfo` and `SpeciesInfo`
  
  * Some joins are established automatically as part of Tagbase's design
  
  * Join up `Query3` and `TagInfo` via the field, `TagID`
  
http://tagbase.googlecode.com/svn/trunk/images/Query2000e1.jpg  
  
 * Hit the exclamation mark *!* button (*Run*) to see the results
 
http://tagbase.googlecode.com/svn/trunk/images/Query2000e2.jpg 

 * Save query as `Query4`
  

== Further examples ==

It is worthwhile to visit the link below or search over the web to check out more general examples. You will appreciate the power of databases and queries as you learn more about queries.

http://www.databasedev.co.uk/queries.html